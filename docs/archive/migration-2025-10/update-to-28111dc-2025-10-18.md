# Update to tree-sitter-quarto@28111dc

**Date**: October 18, 2025
**Action**: Updated to latest upstream grammar, removed local injection fixes

## Changes Made

### 1. Updated Grammar Version

**From**: `c2c28fd` (Oct 17)
**To**: `28111dc` (Oct 18 - latest)

**New Features in 28111dc**:
- Added emphasis delimiter captures for theme flexibility
- Allows themes to style `*` and `**` delimiters differently from content

### 2. Reverted Local Injection Query Fixes

**Removed our local fixes** to `languages/quarto/injections.scm`:
- Previously added `(code_line) @injection.content` to all fenced code block patterns
- Now matches upstream version exactly
- **Result**: Standard Markdown code blocks (` ```python`) will NOT have syntax highlighting until upstream is fixed

### 3. Updated Files

- `extension.toml`: rev = `28111dc81e39afac5a012a4d08f242da5e41fec8`
- `build.rs`: QUARTO_COMMIT = `28111dc81e39afac5a012a4d08f242da5e41fec8`
- `languages/quarto/injections.scm`: Copied from upstream (without fixes)

## Current State

### ✅ What Works

- **Quarto executable code cells**: ` ```{python}` style blocks have syntax highlighting
- **Inline executable cells**: `` `{r} expr` `` have syntax highlighting
- **Emphasis/bold**: Content and delimiters can be styled separately
- **Headings, citations, shortcodes**: All working as before

### ❌ What's Broken (Known Issue)

- **Standard Markdown fenced code blocks**: ` ```python` do NOT have syntax highlighting
- Affects all languages: Python, R, Julia, JavaScript, TypeScript, Bash, SQL, JSON, YAML, HTML, CSS, etc.
- **Root cause**: Upstream injection queries missing `@injection.content` capture
- **Tracked in**: https://github.com/ck37/tree-sitter-quarto/issues/7

## Why We Reverted

1. **Upstream fix needed**: The bug should be fixed in tree-sitter-quarto, not worked around in the extension
2. **Clean baseline**: Using pure upstream lets us verify the issue exists and test the fix properly
3. **Community benefit**: When upstream is fixed, all editors using the grammar benefit

## Testing Instructions

To verify the current state in Zed:

1. **Restart Zed completely** (clear caches)
2. **Install dev extension**: Cmd+Shift+P → "zed: install dev extension"
3. **Create test file** `test.qmd`:

```markdown
# Test File

## Quarto Executable (Should Work)
\`\`\`{python}
import numpy as np
print("This should be highlighted")
\`\`\`

## Standard Markdown (Won't Work)
\`\`\`python
import pandas as pd
print("This will NOT be highlighted")
\`\`\`
```

4. **Expected behavior**:
   - ✅ Quarto executable block: Python syntax highlighted
   - ❌ Standard Markdown block: No syntax highlighting (plain text)

## Next Steps

1. **Wait for upstream fix**: Monitor issue #7 for discussion and PR
2. **Test the fix**: Once upstream merges the fix, update to that commit
3. **Verify**: Confirm standard Markdown code blocks get highlighting
4. **Release**: Ship extension with working grammar version

## Temporary Workaround (If Needed)

If users need code block highlighting urgently, they can:
1. Use Quarto executable syntax: ` ```{python}` instead of ` ```python`
2. Or wait for upstream fix (should be quick - it's a one-line change per language)

## Files Changed

- `extension.toml`
- `build.rs`
- `languages/quarto/injections.scm`
- `docs/code-injection-fix-2025-10-18.md` (documents the fix)
- `docs/update-to-28111dc-2025-10-18.md` (this file)

## Related

- **Issue #7**: https://github.com/ck37/tree-sitter-quarto/issues/7
- **Grammar commit**: https://github.com/ck37/tree-sitter-quarto/commit/28111dc
- **Previous commit**: https://github.com/ck37/tree-sitter-quarto/commit/c2c28fd
